<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö | Glossy Girl</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #ff6f91;
            --secondary: #845ec2;
            --bg: #f8f9fa;
            --text: #2d3436;
            --glass: rgba(255, 255, 255, 1);
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg);
            margin: 0;
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--text);
            color: white;
            padding: 40px 20px;
            display: flex;
            flex-direction: column;
        }

        .sidebar h1 {
            font-size: 24px;
            font-weight: 800;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 50px;
        }

        .nav-link {
            padding: 15px 20px;
            border-radius: 12px;
            color: #ddd;
            text-decoration: none;
            margin-bottom: 10px;
            transition: 0.3s;
            font-weight: 600;
        }

        .nav-link.active,
        .nav-link:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 40px;
            background: #fff;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: #f1f3f5;
            padding: 25px;
            border-radius: 20px;
            text-align: left;
        }

        .stat-card h4 {
            margin: 0;
            font-size: 14px;
            color: #666;
        }

        .stat-card p {
            margin: 10px 0 0;
            font-size: 28px;
            font-weight: 800;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        /* Table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .data-table th,
        .data-table td {
            text-align: left;
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        .data-table th {
            font-weight: 700;
            color: #666;
        }

        .btn {
            background: var(--text);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: 0.3s;
        }

        .btn:hover {
            background: var(--primary);
        }

        .btn-add {
            background: var(--primary);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 24px;
            width: 500px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: 1px solid #ddd;
            box-sizing: border-box;
        }

        @media (max-width: 1100px) {
            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                padding: 20px;
                border-right: none;
                border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            }

            .sidebar h1 {
                margin-bottom: 20px;
                text-align: center;
            }

            .sidebar a.nav-link[style*="margin-top: auto"] {
                margin-top: 20px !important;
            }

            .main-content {
                padding: 20px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 90%;
                padding: 25px;
            }

            /* Responsive Table */
            .table-container {
                width: 100%;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
        }
    </style>
</head>

<body>

    <div class="sidebar">
        <h1>Glossy Girl Admin</h1>
        <a href="#" class="nav-link active">üìä ‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°</a>
        <a href="#" class="nav-link">üì¶ ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</a>
        <a href="#" class="nav-link">üí∞ ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</a>
        <a href="shop1.html" class="nav-link" style="margin-top: auto;">üè† ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô</a>
    </div>

    <div class="main-content">
        <div class="dashboard-header">
            <h2>‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö</h2>
            <button class="btn btn-add" onclick="toggleModal(true)">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</button>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h4>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h4>
                <p id="statRevenue">‡∏ø0</p>
            </div>
            <div class="stat-card">
                <h4>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</h4>
                <p id="statOrders">0</p>
            </div>
            <div class="stat-card">
                <h4>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡∏≤‡∏¢</h4>
                <p id="statProducts">0</p>
            </div>
            <div class="stat-card">
                <h4>‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≠‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</h4>
                <p id="statAvg">‡∏ø0</p>
            </div>
        </div>

        <h3>üì¶ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                        <th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
                        <th>‡∏£‡∏≤‡∏Ñ‡∏≤</th>
                        <th>‡∏™‡∏ï‡πá‡∏≠‡∏Å</th>
                        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                        <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                    </tr>
                </thead>
                <tbody id="inventoryBody">
                    <tr>
                        <td colspan="6" style="text-align:center;">Loading products...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div class="modal" id="productModal">
        <div class="modal-content">
            <h3>‚ú® ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</h3>
            <form id="productForm">
                <div class="form-group">
                    <label>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                    <input type="text" id="name" required>
                </div>
                <div class="form-group">
                    <label>‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ø)</label>
                    <input type="number" id="price" required>
                </div>
                <div class="form-group">
                    <label>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                    <select id="category">
                        <option>Lipstick</option>
                        <option>Skin Care</option>
                        <option>Foundation</option>
                        <option>Eyes</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</label>
                    <input type="number" id="stock" required>
                </div>
                <div class="form-group">
                    <label>URL ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</label>
                    <input type="url" id="image" placeholder="https://..." required>
                </div>
                <div class="form-group">
                    <label>‡πÅ‡∏ó‡πá‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡πÄ‡∏ä‡πà‡∏ô New, Hot)</label>
                    <input type="text" id="tag">
                </div>

                <div style="display:flex; gap: 10px; margin-top:20px;">
                    <button type="submit" class="btn btn-add" style="flex:1;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‚ú®</button>
                    <button type="button" class="btn" onclick="toggleModal(false)" style="flex:1;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                </div>
            </form>
        </div>
    </div>

    <script src="auth.js"></script>
    <script>
        const user = auth.getUser();
        if (!user || user.role !== 'Admin') {
            alert('Access Denied: Admins Only!');
            window.location.href = 'shop1.html';
        }

        async function init() {
            await fetchStats();
            await fetchInventory();
        }

        async function fetchStats() {
            try {
                const res = await fetch(`${auth.apiUrl}?action=getSalesStats`);
                const data = await res.json();
                if (data.success) {
                    document.getElementById('statRevenue').innerText = `‡∏ø${parseFloat(data.revenue).toLocaleString()}`;
                    document.getElementById('statOrders').innerText = data.totalSales;
                    const avg = data.totalSales > 0 ? (data.revenue / data.totalSales) : 0;
                    document.getElementById('statAvg').innerText = `‡∏ø${avg.toLocaleString()}`;
                }
            } catch (e) { console.error(e); }
        }

        async function fetchInventory() {
            const res = await auth.getProducts();
            if (res.success) {
                const grid = document.getElementById('inventoryBody');
                document.getElementById('statProducts').innerText = res.products.length;

                grid.innerHTML = res.products.map(p => {
                    const stock = parseInt(p.stock);
                    const status = stock === 0 ? '<span style="color:#eb4d4b; font-weight:800;">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏°‡∏î</span>' :
                        (stock < 5 ? '<span style="color:#f1c40f;">‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ô‡πâ‡∏≠‡∏¢</span>' : '‡∏õ‡∏Å‡∏ï‡∏¥');
                    return `
                        <tr>
                            <td>
                                <div style="display:flex; align-items:center; gap:10px;">
                                    <img src="${p.image}" style="width:30px; height:30px; border-radius:5px; object-fit:cover;">
                                    <span>${p.name}</span>
                                </div>
                            </td>
                            <td>${p.category}</td>
                            <td>‡∏ø${parseFloat(p.price).toLocaleString()}</td>
                            <td><input type="number" value="${p.stock}" style="width:60px;" onchange="updateStock('${p.id}', this.value)"></td>
                            <td>${status}</td>
                            <td><button class="btn" style="padding:5px 10px; font-size:12px;" onclick="alert('‡πÄ‡∏£‡πá‡∏ß‡πÜ ‡∏ô‡∏µ‡πâ: ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î')">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button></td>
                        </tr>
                    `;
                }).join('');
            }
        }

        async function updateStock(id, newValue) {
            try {
                const res = await fetch(auth.apiUrl, {
                    method: 'POST',
                    body: JSON.stringify({ action: 'updateStock', productId: id, newStock: newValue })
                });
                const result = await res.json();
                if (result.success) {
                    alert('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞! ‚ú®');
                    fetchInventory(); // Refresh view
                }
            } catch (e) { alert('Stock update failed'); }
        }

        function toggleModal(show) {
            document.getElementById('productModal').style.display = show ? 'flex' : 'none';
        }

        document.getElementById('productForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button[type="submit"]');
            btn.disabled = true;
            btn.innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';

            const payload = {
                name: document.getElementById('name').value,
                price: document.getElementById('price').value,
                category: document.getElementById('category').value,
                stock: document.getElementById('stock').value,
                image: document.getElementById('image').value,
                tag: document.getElementById('tag').value
            };

            const res = await auth.addProduct(payload);
            if (res.success) {
                alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‚ú®');
                toggleModal(false);
                fetchInventory();
            } else {
                alert('Error: ' + res.message);
            }
            btn.disabled = false;
            btn.innerText = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‚ú®';
        });

        init();
    </script>
</body>

</html>